sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/model/FilterOperator","sap/m/GroupHeaderListItem","sap/ui/Device","sap/ui/core/Fragment","sap/m/MessageBox","sap/ui/table/RowAction","sap/ui/table/RowActionItem","sap/ui/table/RowSettings","../model/formatter"],function(e,t,a,r,o,n,i,d,s,c,u,l,g){"use strict";return e.extend("com.fe.zmroui.controller.VendorList",{formatter:g,onInit:function(){this.getRouter().getRoute("vendorList").attachPatternMatched(this._onRouteMatched,this);this.extendTable()},onNavBack:function(){history.go(-1)},_onRouteMatched:function(){this.setSelKey("vendorList")},onLinksDownload:function(e){var t=e.getSource(),a=t.getParent().getBindingContext("vendorData").getObject();var r=new sap.m.Popover({placement:"Bottom",showHeader:false,content:[new sap.m.HBox({items:[new sap.ui.core.Icon({src:"sap-icon://edit",size:"1.0rem"}).addStyleClass("sapUiSmallMarginBeginEnd"),new sap.m.Link({text:"Modify",press:this.onModify.bind(this,t),enabled:true,wrapping:true})]}).addStyleClass("sapUiSmallMarginTopBottom sapUiSmallMarginEnd"),new sap.m.HBox({items:[new sap.ui.core.Icon({src:"sap-icon://delete",size:"1.0rem",color:"red"}).addStyleClass("sapUiSmallMarginBeginEnd"),new sap.m.Link({text:"Delete",enabled:true,press:this.onDelete.bind(this,t),wrapping:true})]}).addStyleClass("sapUiSmallMarginBottom linkColorReject")]});r.openBy(t)},onModify:function(e,t){this.openDialog(e,true)},onDetailPress:function(e){var t=e.getSource(),a=t.getParent().getBindingContext("vendorData").getObject();this.openDialog(t,false)},openDialog:function(e,t){var a=e.getBindingContext("vendorData");var r=a.getPath();if(!this._oDialog){this._oDialog=sap.ui.xmlfragment(this.createId("FrgVendorData"),"com.fe.zmroui.view.fragments.VendorForm",this);this.getView().addDependent(this._oDialog)}this.byId(sap.ui.core.Fragment.createId("FrgVendorData","SimpleFormToolbarDisplay")).bindElement({path:r,model:"vendorData"});var o=this.getOwnerComponent().getModel("vendorData");o.setProperty("/bText",!t);o.setProperty("/bInput",t);o.setProperty("/bEdit",t);o.refresh(true);this._oDialog.open()},onCloseVendorData:function(){if(this._oDialog){this._oDialog.close();this._oDialog.destroy();this._oDialog=undefined}},onSaveVendorData:function(){var e=this.getOwnerComponent().getModel("vendorData");e.setProperty("/bText",true);e.setProperty("/bInput",false);e.refresh(true);this.onCloseVendorData()},onDelete:function(e,t){this._oDelObj=e.getParent().getBindingContext("vendorData").getObject();s.confirm("Do you want to delete "+this._oDelObj.manufacturerCode+"?",{actions:[s.Action.YES,s.Action.CANCEL],initialFocus:s.Action.CANCEL,onClose:function(e){if(e==="YES"){var t=this.getOwnerComponent().getModel("vendorData");var a=t.getProperty("/vendorListData");a=a.filter(e=>e.manufacturerCode!==this._oDelObj.manufacturerCode);t.setProperty("/vendorListData",a);t.refresh(true);sap.m.MessageToast.show(this._oDelObj.manufacturerCode+" Deleted successfully ")}}.bind(this)})},handleAddVendorDetails:function(){if(!this._DialogAddVendor){this._DialogAddVendor=sap.ui.xmlfragment(this.createId("FrgAddVendorData"),"com.fe.zmroui.view.fragments.AddVendorForm",this);this.getView().addDependent(this._DialogAddVendor)}this._DialogAddVendor.open()},onCloseVendor:function(){if(this._DialogAddVendor){this._DialogAddVendor.close();this._DialogAddVendor.destroy(true);this._DialogAddVendor=undefined}},onaddVendorData:function(){this.getView().byId("idVLTData").getBinding("items").filter("");var e=this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","manufacturerCodeId")).getValue();var t=this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","manufacturerDescId")).getValue();var a=this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","localDealerManufacturerCodeId")).getValue();var r=this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","localDealerMaufacturerDescId")).getValue();var o=this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","purchasingOrganizationId")).getValue();var n=this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","purchasingOrganizationDescId")).getValue();var i=this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","paymentTermsId")).getValue();var d=this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","paymentTermDescId")).getValue();var s=this.getFormattedDate();var c=this.getFormattedDate();var u="Active";if(e!=""&&t!=""&&r!=""&&o!=""){var l={manufacturerCode:e,manufacturerDesc:t,localDealerManufacturerCode:a,localDealerMaufacturerDesc:r,purchasingOrganization:o,purchasingOrganizationDesc:n,paymentTerms:i,paymentTermDesc:d,creationDate:s,latestDate:c,status:u};var g=this.getOwnerComponent().getModel("vendorData");var h=g.getProperty("/vendorListData");if(typeof h!=="undefined"&&h!==null&&h.length>0){h.unshift(l)}else{h=[];h.unshift(l)}g.setProperty("/vendorListData",h);g.refresh(true);this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","manufacturerCodeId")).setValue("");this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","manufacturerDescId")).setValue("");this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","localDealerManufacturerCodeId")).setValue("");this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","localDealerMaufacturerDescId")).setValue("");this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","purchasingOrganizationId")).setValue("");this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","purchasingOrganizationDescId")).setValue("");this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","paymentTermsId")).setValue("");this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","paymentTermDescId")).setValue("");this.onCloseVendor()}else{alert("fields cannot be blank")}},onSearch:function(e){var t=[];var r=e.getSource().getValue();if(r&&r.length>0){var n=new a("manufacturerCode",o.Contains,r);t.push(n)}var i=this.byId("idVLTData");var d=i.getBinding("items");d.filter(t,"Application")},createRecord:function(){var e=this.getOwnerComponent().getModel("mrosrv_v2");var t={manufacturerCode:"1000101",localManufacturerCode:"L120944",country:"IN",countryDesc:"India"};e.create("/VendorList",t,{success:function(e){console.log(e)},error:function(e){console.log(e)}})},handleAddVendor:function(){if(!this._DialogAddVendor){this._DialogAddVendor=sap.ui.xmlfragment(this.createId("FrgAddVendorData"),"com.fe.zmroui.view.fragments.AddVendorForm",this);this.getView().addDependent(this._DialogAddVendor)}this._DialogAddVendor.open()},onCloseVendor:function(){if(this._DialogAddVendor){this._DialogAddVendor.close();this._DialogAddVendor.destroy(true);this._DialogAddVendor=undefined}},onSaveNewVendorData:function(){var e=this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","idIpManf")).getValue();var t=this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","idIpManfDesc")).getValue();var a=this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","idIpLocalManf")).getValue();var r=this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","idIpLocalManfDesc")).getValue();var o=this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","idIpCountry")).getValue();var n=this.byId(sap.ui.core.Fragment.createId("FrgAddVendorData","idIpCountryDesc")).getValue();var i={};i.manufacturerCode=e;i.localManufacturerCode=a;i.country=o;i.countryDesc=n;i.manufacturerCodeDesc=t;i.localManufacturerCodeDesc=r;var d=this.getOwnerComponent().getModel();sap.ui.core.BusyIndicator.show();d.create("/VendorList",i,{success:function(e){console.log(e);this.onCloseVendor();sap.ui.core.BusyIndicator.hide();s.success("Record created successfully")}.bind(this),error:function(e){sap.ui.core.BusyIndicator.hide();console.log(e);var t=JSON.parse(e.responseText).error.message;s.show(t.value,sap.m.MessageBox.Icon.ERROR,"Error In Create Operation")}.bind(this)})},extendTable:function(){var e=this.byId("idUiTab");var t=this.handleActionPress.bind(this);var a=e.getRowActionTemplate();if(a){a.destroy();a=null}var r;this.modes=[{key:"Multi",text:"Multiple Actions",handler:function(){var e=new c({items:[new u({text:"Delete",press:t,type:sap.ui.table.RowActionType.Delete})]});return[2,e]}}];for(var o=0;o<this.modes.length;o++){if("Multi"==this.modes[o].key){var n=this.modes[o].handler();r=n[0];a=n[1];break}}e.setRowActionTemplate(a);e.setRowActionCount(r)},handleActionPress:function(e){var t=e.getParameter("row");var a=e.getParameter("item");if(a.getType()==="Delete"){this.onDelete(e)}},onDelete:function(e){var t=this.getOwnerComponent().getModel("mrosrv_v2");this.getView().setBusy(true);t.remove(e.getParameter("row").getBindingContext().sPath,{success:function(e){this.getView().setBusy(false);s.success("Record Deleted successfully")}.bind(this),error:function(e){this.getView().setBusy(false);var t=JSON.parse(e.responseText).error.message;s.show(t.value,sap.m.MessageBox.Icon.ERROR,"Error In Create Operation")}.bind(this)})}})});