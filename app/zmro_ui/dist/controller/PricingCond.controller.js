sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/model/FilterOperator","sap/m/GroupHeaderListItem","sap/ui/Device","sap/ui/core/Fragment","sap/m/MessageBox","../model/formatter"],function(e,t,i,a,r,n,d,o,s,c){"use strict";return e.extend("com.fe.zmroui.controller.PricingCond",{formatter:c,onInit:function(){this.getRouter().getRoute("pricingCond").attachPatternMatched(this._onRouteMatched,this)},onNavBack:function(){history.go(-1)},_onRouteMatched:function(){this.setSelKey("pricingCond")},onModify:function(e,t){this.openDialog(e,true)},onDetailPress:function(e){var t=e.getSource(),i=t.getParent().getBindingContext("pricingData").getObject();this.openDialog(t,false)},openDialog:function(e,t){var i=e.getBindingContext("pricingData");var a=i.getPath();if(!this._oDialog){this._oDialog=sap.ui.xmlfragment(this.createId("FrgPricingData"),"com.fe.zmroui.view.fragments.PricingConditionForm",this);this.getView().addDependent(this._oDialog)}this.byId(sap.ui.core.Fragment.createId("FrgPricingData","SimpleFormToolbarPricingDisplay")).bindElement({path:a,model:"pricingData"});var r=this.getOwnerComponent().getModel("pricingData");r.setProperty("/bText",!t);r.setProperty("/bInput",t);r.setProperty("/bEdit",t);r.refresh(true);this._oDialog.open()},onClosePricingData:function(){if(this._oDialog){this._oDialog.close();this._oDialog.destroy();this._oDialog=undefined}},onSavePricingData:function(){var e=this.getOwnerComponent().getModel("pricingData");e.setProperty("/bText",true);e.setProperty("/bInput",false);e.refresh(true);this.onClosePricingData()},handleAddPricingDetails:function(){if(!this._DialogAddPricing){this._DialogAddPricing=sap.ui.xmlfragment(this.createId("FrgAddPricingData"),"com.fe.zmroui.view.fragments.AddPricingForm",this);this.getView().addDependent(this._DialogAddPricing)}this._DialogAddPricing.open()},onClosePricing:function(){if(this._DialogAddPricing){this._DialogAddPricing.close();this._DialogAddPricing.destroy(true);this._DialogAddPricing=undefined}},onaddPricingData1:function(){this.getView().byId("idPLTData").getBinding("items").filter("");var e=this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","manufacturerCodeId")).getValue();var t=this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","manufacturerDescId")).getValue();var i=this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","countryId")).getValue();var a=this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","countryCodeId")).getValue();var r=this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","plantId")).getValue();var n=this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","plantDescriptionId")).getValue();var d=this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","exchangeRateId")).getValue();var o=this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","countryFactorId")).getValue();var s=this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","validityStartId")).getValue();var c=this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","validityEndId")).getValue();var g=this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","localOwnershipId")).getSelected();var u=this.getFormattedDate();var l=this.getFormattedDate();var p="Active";if(e!=""&&t!=""&&i!=""&&a!=""&&r!=""){var h={manufacturerCode:e,manufacturerDesc:t,country:i,countryCode:a,plant:r,plantDescription:n,exchangeRate:d,countryFactor:o,validityStart:s,validityEnd:c,localOwnership:g,creationDate:u,latestDate:l,status:p};var I=this.getOwnerComponent().getModel("pricingData");var m=I.getProperty("/pricingConditionData");if(typeof m!=="undefined"&&m!==null&&m.length>0){m.unshift(h)}else{m=[];m.unshift(h)}I.setProperty("/pricingConditionData",m);I.refresh(true);this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","manufacturerCodeId")).setValue("");this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","manufacturerDescId")).setValue("");this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","countryId")).setValue("");this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","countryCodeId")).setValue("");this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","plantId")).setValue("");this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","plantDescriptionId")).setValue("");this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","exchangeRateId")).setValue("");this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","countryFactorId")).setValue("");this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","validityStartId")).setValue("");this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","validityEndId")).setValue("");this.byId(sap.ui.core.Fragment.createId("FrgAddPricingData","localOwnershipId")).setSelected(false);this.onClosePricing()}else{alert("fields cannot be blank")}},onSearch:function(e){var t=[];var a=e.getSource().getValue();if(a&&a.length>0){var n=new i("manufacturerCode",r.Contains,a);t.push(n)}var d=this.byId("idPLTData");var o=d.getBinding("items");o.filter(t,"Application")},onPressActions:function(e){var t=e.getSource(),i=t.getParent().getBindingContext().getObject();var a=new sap.m.Popover({placement:"Bottom",showHeader:false,content:[new sap.m.VBox({items:[new sap.m.Button({text:"Edit",icon:"sap-icon://edit",type:"Transparent",width:"6rem",press:this.onModify.bind(this,t)}),new sap.m.Button({text:"Delete",icon:"sap-icon://delete",type:"Transparent",width:"6rem",press:this.onPressDelete.bind(this,t)})]}).addStyleClass("sapUiTinyMargin")]}).addStyleClass("sapUiResponsivePadding");a.openBy(t)},onPressDelete:function(e,t){this._oDelObjContext=e.getParent().getBindingContext();s.confirm("Do you want to delete the record?",{actions:[s.Action.YES,s.Action.CANCEL],initialFocus:s.Action.CANCEL,onClose:function(e){if(e==="YES"){this.onDelete(this._oDelObjContext)}}.bind(this)})},onDelete:function(e){var t=this.getOwnerComponent().getModel("mrosrv_v2");this.getView().setBusy(true);t.remove(e.sPath,{success:function(e){this.getView().setBusy(false);s.success("Record Deleted successfully")}.bind(this),error:function(e){this.getView().setBusy(false);var t=JSON.parse(e.responseText).error.message;s.show(t.value,sap.m.MessageBox.Icon.ERROR,"Error In Create Operation")}.bind(this)})},handleAddPricing:function(){if(!this._DialogAddPricing){this._DialogAddPricing=sap.ui.xmlfragment(this.createId("FrgAddPricing"),"com.fe.zmroui.view.fragments.AddPricingForm",this);this.getView().addDependent(this._DialogAddPricing)}this._DialogAddPricing.open()},onClosePricing:function(){if(this._DialogAddPricing){this._DialogAddPricing.close();this._DialogAddPricing.destroy(true);this._DialogAddPricing=undefined}},onaddPricingData:function(){var e=this.byId(sap.ui.core.Fragment.createId("FrgAddPricing","idIpManf")).getValue();var t=this.byId(sap.ui.core.Fragment.createId("FrgAddPricing","idIpManfDesc")).getValue();var i=this.byId(sap.ui.core.Fragment.createId("FrgAddPricing","idIpCountry")).getValue();var a=this.byId(sap.ui.core.Fragment.createId("FrgAddPricing","idIpCountryDesc")).getValue();var r=this.byId(sap.ui.core.Fragment.createId("FrgAddPricing","idIpContFact")).getValue();var n=this.byId(sap.ui.core.Fragment.createId("FrgAddPricing","validityStartId")).getValue();var d=this.byId(sap.ui.core.Fragment.createId("FrgAddPricing","validityEndId")).getValue();var o=this.byId(sap.ui.core.Fragment.createId("FrgAddPricing","idIpExchRate")).getValue();var c={};c.ManufacturerCode=e;c.Country=i;c.countryDesc=a;c.manufacturerCodeDesc=t;c.CountryFactor=isNaN(parseInt(r))&&r===""?0:parseFloat(r);c.ExchangeRate=isNaN(parseInt(o))&&o===""?0:parseFloat(o);c.ValidityStart=n===""?null:new Date(n).toISOString();c.ValidityEnd=d===""?null:new Date(d).toISOString();var g=this.getOwnerComponent().getModel();sap.ui.core.BusyIndicator.show();g.create("/PricingConditions",c,{success:function(e){console.log(e);this.onClosePricing();sap.ui.core.BusyIndicator.hide();s.success("Record created successfully")}.bind(this),error:function(e){console.log(e);sap.ui.core.BusyIndicator.hide();var t=JSON.parse(e.responseText).error.message;s.show(t.value,sap.m.MessageBox.Icon.ERROR,"Error In Create Operation")}.bind(this)})}})});